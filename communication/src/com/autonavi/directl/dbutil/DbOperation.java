package com.autonavi.directl.dbutil;

import java.sql.Connection;
import java.sql.PreparedStatement;
import java.sql.ResultSet;
import java.sql.SQLException;
import java.sql.Statement;
import java.sql.Timestamp;
import java.text.SimpleDateFormat;
import java.math.BigDecimal;
import java.rmi.RemoteException;
import java.util.ArrayList;
import java.util.Date;
import java.util.regex.Matcher;
import java.util.regex.Pattern;
import java.io.*;
import com.autonavi.directl.Log;
import com.autonavi.directl.bean.TArea;
import com.autonavi.directl.bean.TEnt;
import com.autonavi.directl.bean.TSpeedCase;
import com.autonavi.directl.bean.TTerminal;
import com.autonavi.directl.parse.ParseBase;
import com.autonavi.directl.parse.PictureCacher;
import com.sos.sosgps.api.DPoint;
import com.sos.sosgps.api.CoordAPI;

 

/**
 * @author a
 * 
 */
public class DbOperation {

	/**
	 * 建立数据库连接,先从连接池中获取，如果为NULL，则直接连接数据库
	 * 
	 * @return boolean
	 */
	public  static Connection getConnection() {
		Connection conn = null;
		conn = DbUtil.getConnection();

		return conn;
	}
	
	public  static Connection getNodeConnection() {
		Connection conn = null;
		conn = DbUtil.getNodeConnection();

		return conn;
	}

	/**
	 * 释放资源
	 */
	public  static void release(Statement stmt, ResultSet rs,
			PreparedStatement pstmt, Connection con) {
		try {
			if (rs != null) {
				rs.close();
			}
			if (stmt != null) {
				stmt.close();
			}
			if (pstmt != null) {
				pstmt.close();
			}
			if (con != null && !con.isClosed()) {
				con.close();
			}
		} catch (SQLException e) {
			Log.getInstance().errorLog(e.getMessage(), e);
		}
	}
	/**
	 * 插入报警信息
	 * @param base ,基本信息
	 * @param type 报警类型 1超速 2区域 3主动 6偏航
	 * @param caseid 案例ID
	 * @return
	 */
	public synchronized boolean insertAlarm(ParseBase base, String type,long caseid) {
		boolean flag = false;
		Connection conn = DbUtil.getConnection();
		PreparedStatement pst = null;
		Statement stm = null;
		
		String sql = "insert into t_area_locrecord (id,device_id,longitude,latitude,speed,direction,height,distance,alarm_time,alarm_type,case_id,jmx,jmy) ";
		sql += "values(SEQ_AREALARM_LOCRECORD.NEXTVAL,?,?,?,?,?,?,?,?,?,?,?,?)";
		 
		double[] xx = new double[1];// 原始经度
		double[] yy = new double[1];// 原始纬度
		xx[0] = Float.parseFloat(base.getCoordX());
		yy[0] = Float.parseFloat(base.getCoordY());
		CoordAPI coordAPI = new CoordAPI();
		DPoint dpoint = new DPoint();
		
		String mx = "";
		String my = "";
		DPoint[] pts = null;
		try {
			// 加密偏转原始坐标
			pts = coordAPI.encryptConvert(xx, yy);
			mx = pts[0].getEncryptX();
			my = pts[0].getEncryptY();
		} catch (Exception e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		}
		
		try {
			conn.setAutoCommit(false);
			pst = conn.prepareStatement(sql);
			
			pst.setString(1, base.getDeviceSN());
			pst.setFloat(2, Float.parseFloat(base.getCoordX()==null ? "0" :base.getCoordX()));
			pst.setFloat(3, Float.parseFloat(base.getCoordY()==null ? "0" :base.getCoordY()));
			pst.setFloat(4, Float.parseFloat(base.getSpeed()==null ? "0" :base.getSpeed()));
			pst.setFloat(5, Float.parseFloat(base.getDirection()==null ? "0" :base.getDirection()));
			pst.setFloat(6, Float.parseFloat(base.getAltitude()==null ? "0" : base.getAltitude()));
			pst.setFloat(7, Float.parseFloat(base.getLC()==null ? "0" :base.getLC()));
			pst.setTimestamp(8, base.getTimeStamp());
			pst.setString(9, type);
			pst.setLong(10, caseid);
			pst.setString(11, mx);
			pst.setString(12, my);
 			
			pst.execute();
			conn.commit();
			conn.setAutoCommit(true);
			flag = true;
		} catch (Exception ex) {
			flag = false;
			ex.printStackTrace();
			Log.getInstance().outLog("插入报警信息异常：" + ex.getMessage());
		} finally {
			 
			DbOperation.release(null, null, pst, conn);
		}
		return flag;
	}
	/**
	 * 获取速度案例ID
	 * @param devid
	 * @return
	 */
	public synchronized TSpeedCase findSpeedCaseId(String devid) {
		int id = 0;
		Connection conn =  DbUtil.getConnection();
		PreparedStatement pst = null;
		ResultSet rs = null;
		TSpeedCase tcase = null;
		
		String sql = "select * from t_speed_case where device_id=? and flag=1 order by crtdate desc";
		//String sql = "select * from t_speed_case where device_id=?  order by crtdate desc";

		 
		try {
			 
			pst = conn.prepareStatement(sql);
			pst.setString(1, devid);
 			
			rs = pst.executeQuery();
			if (rs.next()){
				tcase = new TSpeedCase();
				tcase.setId(rs.getLong("id"));
				tcase.setMaxSpeed(rs.getFloat("max_speed"));
			}
			 
			 
		} catch (Exception ex) {
			 
			Log.getInstance().errorLog("查询速度案例信息异常：" + ex.getMessage(), ex);
		} finally {
			 
			DbOperation.release(null, rs, pst, conn);
		}
		
		return tcase;
		 
	}
	
	/**
	 * 获取区域案例
	 * @param devid
	 * @return
	 */
	public synchronized TArea findAreaCaseId(String devid) {
		 
		Connection conn = DbUtil.getConnection();
		TArea areaCase = null;
		
		PreparedStatement pst = null;
		ResultSet rs = null;
		
		String sql = "select * from t_area where device_id=? and flag=1 order by CREATEDATE desc";
		//String sql = "select * from t_area where device_id=?  order by CREATEDATE desc";
		 

		 
		try {
			conn.setAutoCommit(false);
			pst = conn.prepareStatement(sql);
			pst.setString(1, devid);
 			
			rs = pst.executeQuery();
			if (rs.next()){
				areaCase = new TArea();
				areaCase.setId(rs.getLong("ID"));
				areaCase.setDeviceId(rs.getString("device_id"));
				areaCase.setBeginDate(rs.getString("begin_date"));
				areaCase.setEndDate(rs.getString("end_date"));
				areaCase.setType(rs.getString("type"));
				areaCase.setXy(rs.getString("xy"));
				areaCase.setEndDate(rs.getString("ep_code"));				
			}
			conn.commit();
			conn.setAutoCommit(true);
		} catch (Exception ex) {
			 
			Log.getInstance().errorLog("查询区域案例信息异常：" + ex.getMessage(), ex);
			
		} finally {
			 
			DbOperation.release(null, rs, pst, conn);
		}
		
		return areaCase;
		 
	}
	
	 
	
	/**
	 * 获取偏航案例ID
	 * @param devid
	 * @return
	 */
	public  synchronized int findLineCaseId(String devid) {
		int id = 0;
		Connection conn = DbUtil.getConnection();
		PreparedStatement pst = null;
		ResultSet rs = null;
		
		String sql = "select * from t_line_alarm where deviceid=? order by CREATEDATE desc";
		 
		 
		try {
			conn.setAutoCommit(false);
			pst = conn.prepareStatement(sql);
			pst.setString(1, devid);
 			
			rs = pst.executeQuery();
			if (rs.next()){
				id = rs.getInt("id");
			}
			conn.commit();
			conn.setAutoCommit(true);
		} catch (Exception ex) {
			 
			Log.getInstance().errorLog("查询区域案例信息异常：" + ex.getMessage(), ex);
		} finally {
			 
			DbOperation.release(null, rs, pst, conn);
		}
		
		return id;
		 
	}
	/**
	 * 保存终端上行图片的基本信息
	 * @param base
	 * @param type
	 * @param content
	 */
	public synchronized  void insertPicMsg(ParseBase base){
		Connection conn = DbUtil.getConnection();
		PreparedStatement pst = null;
		Statement stm = null;
		
		String sql = "insert into t_muti_medium (id,device_id,longitude,lantitude,upload_time) ";
		sql += "values(SEQ_MULTI_MEDIUM.NEXTVAL,?,?,?,sysdate)";
		 
		try {
			conn.setAutoCommit(false);
			pst = conn.prepareStatement(sql);
			pst.setString(1, base.getDeviceSN());
			pst.setString(2, base.getDeviceSN());
			pst.setFloat(3, Float.parseFloat(base.getCoordX()));
			pst.setFloat(4, Float.parseFloat(base.getCoordY()));
			
 			pst.execute();
			conn.commit();
			conn.setAutoCommit(true);
		} catch (Exception ex) {
			 
			Log.getInstance().errorLog("插入上传图片基本信息异常：" + ex.getMessage(), ex);
		} finally {
			 
			DbOperation.release(null, null, pst, conn);
		}
	}
	

	
	/**
	 * 保存终端上行信息
	 * @param base
	 * @param type
	 * @param content
	 */
	public synchronized  void insertMessage(ParseBase base, String type, String content){
		Connection conn = DbUtil.getConnection();
		PreparedStatement pst = null;
		Statement stm = null;
		
		String sql = "insert into t_message (id,sender,receiver,content,msg_type,createdate) ";
		sql += "values(SEQ_MESSAGE.NEXTVAL,?,?,?,?,sysdate)";
		 
		try {
			conn.setAutoCommit(false);
			pst = conn.prepareStatement(sql);
			pst.setString(1, base.getDeviceSN());
			pst.setString(2, "位置通平台");
			pst.setString(3, content);
			pst.setString(4, type);
 			pst.execute();
			conn.commit();
			conn.setAutoCommit(true);
		} catch (Exception ex) {
			 
			Log.getInstance().errorLog("插入报警信息异常：" + ex.getMessage(), ex);
		} finally {
			 
			DbOperation.release(null, null, pst, conn);
		}
	}
	
	/**
	 * 更新指令状态
	 * 
	 * @param flag
	 * @return
	 */
	public synchronized void updateInstructionsState(String deviceId, String state, long seq) {
		ArrayList list = new ArrayList();
		PreparedStatement pst = null;
		ResultSet rs = null;
		Connection conn = this.getConnection();
		String sql = "update t_structions set state=? where device_id=? and id=?";

		try {
			
			conn.setAutoCommit(false);
			pst = conn.prepareStatement(sql);
			pst.setString(1, state);
			pst.setString(2, deviceId);
			pst.setLong(3, seq);
			pst.executeQuery();
			conn.commit();
			conn.setAutoCommit(true);
		} catch (SQLException e) {
			Log.getInstance().outLog("更新指令状态失败"+e.getMessage());
			e.printStackTrace();
		} finally {
			DbOperation.release(null, rs, pst, conn);
		}

	}
	
	
	

	 

	public static void main(String[] args) {
		DbOperation op = new DbOperation();
		byte[] img = com.autonavi.directl.Tools
				.fromHexString("230AFFD8FFC4001F0000010501010101010100000000000000000102030405060708090A0BFFC400B5100002010303020403050504040000017D01020300041105122131410613516107227114328191A1082342B1C11552D1F02433627282090A161718191A25262728292A3435363738393A434445464748494A535455565758595A636465666768696A737475767778797A838485868788898A92939495969798999AA2A3A4A5A6A7A8A9AAB2B3B4B5B6B7B8B9BAC2C3C4C5C6C7C8C9CAD2D3D4D5D6D7D8D9DAE1E2E3E4E5E6E7E8E9EAF1F2F3F4F5F6F7F8F9FAFFC4001F0100030101010101010101010000000000000102030405060708090A0BFFC400B51100020102040403040705040400010277000102031104052131061241510761711322328108144291A1B1C109233352F0156272D10A162434E125F11718191A262728292A35363738393A434445464748494A535455565758595A636465666768696A737475767778797A82838485868788898A92939495969798999AA2A3A4A5A6A7A8A9AAB2B3B4B5B6B7B8B9BAC2C3C4C5C6C7C8C9CAD2D3D4D5D6D7D8D9DAE2E3E4E5E6E7E8E9EAF2F3F4F5F6F7F8F9FAFFDB004300080606070605080707070909080A0C140D0C0B0B0C1912130F141D1A1F1E1D1A1C1C20242E2720222C231C1C2837292C30313434341F27393D38323C2E333432FFDB0043010909090C0B0C180D0D1832211C213232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232FFC000110800F0014003012200021101031101FFDD00040000FFDA000801010000FF00A2B9FB746D8FBA09FD315A30951C8F949E4D3FCDC0CE78F4F7A82493200C640AAD1A34974C81773330403D7B52FDA6F342BA965B2BA2892802541F3267A0700F43EFF4A24BFBAD43619EE659B629550F80393CF4033F8D2AAED561C70303DAA1F3101C123E99A644F81B769383DBD2A6C92381F99A32E7FBA3F5A7019EAC69DB57A633F5E6A45C01D314AC77295F5FD284909CA9FBCBC1A33499A33C52134C2698EA72197EF0FD6943061914628C518A4229ACB914C079DA4734A4532938A6961EA2A2DE14F072BEDDA8F314F4C9FA0A37F3F71A8DD9FE1348C323D08EF481D8705467D73C1ADCBAD32EED152E6EAD3ECEAEE22505C33E4F4FBA48C71EB42C6E3DF00E3143AB6410A71803A7E74DF2CE707BF61CD57B466F34CAA4EECE411524F12CAA41E8411C563DAB3AC851C9054E08AD589D580539C1A840C76C531BE59558746E0D4A29C29C29D4E140E29920230EBD475F714F0C186474A5A4A43D2931CD2118A89F084B29193D47AD3C1561C1A09038C37E4690939E10FE94877FF740FA9A421CF71F9534C64FDE63ED4D008E1B39FE741407FF00D74C28BDC0A4207A52546576F2A38EE29720D07EB498E28201E08CD6BE9119D5356B9B1B8BD92391E0492D4BBB4815958EEDA18F1C6320638AE825F0F5FC722885ADE55C72CCC53F4C1FE74E8BC3D7D2F13BDBC3E8636693F4216B33554B6D155AD5643757F2C64B39185857D40EC4F3DEB2AC50A41193D703DEA67E9BBD3B5634A0A6A2E4F01C061572227767F1A7535D77211F953A26DF1838C548294714E069452D21755EA40A8D48472A3254F23FC29FB988E10FE26946E239007E39A42AFD980FC293613D5DA8112FA67EA69C11474503E829857CB6DE3EE9FBC3D29F8C8CD18A42B4D34845319430C1A6670DB4F5EC7D68238A6914CC52530A60EE1C1A14E452D18AD0B3F96E83A9DAE07CAC0E083EC7B56CC37FA842AAA9A84E5472036D7FCCB027F5A8E7BCBDB8D826D42E7299E236F2867DF6633593781521708A15A4201238C9CF7AB30A011818E7151499DFC763D0D559E35762081C640205470028C411DB8CD4DC52E00A8918248E01CA9E454C187604D1B9BB2FE669407FEF01F414A17D598FE34FDA0F6CD0154740050CBB948EFD8FBD246DB9707EF0E0D3E8A3146297146299B7CB39FE03FA53F14845348A4238A615A6B282318A88657E56EBD8FAD06986908A298CA3A8201FE74C332A919CFD6952546FBA738F415A300266551EFF00CAAFAB300011B863A8A198E471CFBD40B6935FDC086050CF1AF9C53382C01C607BE4D5811484C88B04E5E2FBC823395FAFA5585D2BC989AE7546FB3C5B784041727B0AC59E50F26FDA1723EE8ED4DDBC641C51B73CEE6FC2811A8EA33F5E69B2A80A1C0E54D48B82011D0D28A70A5A5C5029D51B82ADE60E7B11EB528E476A5C52E28C5285A50B4BB3230454617610A7EEF634A569A453714C6C0EA71519913B367E9CD44E77AE0237D7A547B9C7CA40CFA9A501BD47E0290A93FC447D29360EE49FC693CB5FEE8FC69B244AEA4743D88AA1868DCE0E1AB63CC78AE209EDA42B3432075C743D883EC4122B588D3CCCCD04D756087E665922F3A204F5DB83B873EBC7D3A5224B6C676599E79205236B4116D2E3DF7E31FAD553335CEB2B3C60C096F18481633F70139EBDC9C9CD6B0D4AFA21318EE06F7F9CB14193F4F4ACA9C6269263CC921CBB1E49354E4E6555F419A71F41D29CA38A7518CF06A38B8DC84F2A7F4A969D45281C52D2D2E2989F23EC3D0F2B528A7014E0B9A76101C175CFA66A23756C8EA8251248C70B1C7F3B31F400726B546937E6D1665B194BB1FF0055B90381EA72D8FD7350476325DFDA92296D81B760926F90800900E3201F5C7D6A8BA4B15CCB6D28092C470CBD73E841F434863CE72C69863507A5215C7614C2298471513286041A60241DADD7F9D2E2908A31498AAF3C1E61DCA70DDEB4318F61ED5695B281875EF8A466E011D01EBD6ABD99CCF29CE72463F2ABCEC4E307271DAAAC8C76919CFCDDEB3A690A5E6D6E148001A9D0E01E47AD4B173B8934FC5151BFC92ABF66E0D4D452D2E28E946E5CF519FAD1BC7B9FA0A6B65C70A720E41A3CFD832F9C7B0E7347DA936C846EF95370E7A9C8E3F239FC2A631A45A837DAE45B9B4B631999222C1595F396CE41C21033DB04E715DBA695A44F6D184B0B1920C6E4DB0A15E7B8E3155AEEDF54B78C43652C6F116DCD24CC23F2D07551B57B8CF3DAB42C24492D55A3BB5BA4C9C48AC18633D323AE3A669B75A6D9DEC12C3710068E5C798012BBB1D3245634BA345A90BA02D66B3BAB7C4305C34ACC1D40041C1E1876E73DF9CD60216605254F2E74E248CF054FD291862A3238A6115130A6114C650C39EDD29809CED6FBC3F5A71A4EF494843121514B31E8A067356AA58725B61EADD3EB4C941008A86D41553CE324D5B18DCA33F88A8881D7236D549E21286078F43E951C126E255B865E2ADC6464815252D3240190827DE91265D833D69C1C9E884FD78A51B88E807E39A363777C7D050225EE58FD4D395557A014E14EA8E440D90DF75BAFB55786311C8F1B7F7BE6E739E383F955C88AC3228310283AAA8C1C7B76CF7ADDF0CDE3D9CEDA64AC0DB924DB3F4C1EA5318FC47E23B5752E8B22323A86561820F422B353EC3E1FB686055758E59480DF78963CF3DCFA7193D2B52A1BB5B96B66168F1A4DC6D6914951CF3903DAB1F5ED2A4B88A3BD8537DE40B860831E6AF718FD473EDDEB9B4749A2122743D88C60D3596A222A36151914D2298C9B87A11C834D0D9241FBC28A3BD5BD3A1DCF24F9C04F917EA793FE1F8D348E68C7719CF63524A7CD4DC38603E61FD6A0830B1806A66CA93DF155D98B37269CBF3274AA37085260E38DDC1AB3031C640C9C54DFBC3D4A8FA5288F9E5D8FE34EF2D7BAE7EB51A0D9395C70C38A9A9451452D2D14B8C820F7A6491B3AE147CE9CFBB2D2C2C197AFD0FA8A9E18A5915914C8707723A93B97E847A7515D8E8DA89BEB4DB2E05CC781201D0FA30E7A1AD078D1CA9745628772923383EA2ABDB5CDC4D757314B66D0C713011C85C1120F503B55AAACF6D236A11DC8B9758D236430FF000B1241DC7DC63F5AE6353B20B24BA969E2296CDB26710B03B587560071F5EF9ACF6008C8E41E86A165A8985464534D46CEA0F24546FF0030CAE73D881447215B88D9A30E8AD89149EAA7838F7C1E0FA81549E49A0904064DC72115B19DD9381F9F15D669F612B40D6D6E9E63C0A0C849032C7A8C9EFD7F2ACCC51C533CE453C364FB7348182BE71F81A73B600C743559D8A8E95695414F6AA571968980EABCD3ACB0C491D855CC52D151CE0ECDE382BFCAA453B9437A8A5A5A28A334A29C2948390C3395E4546EA23759100D8E0903B06EE3E9E95329E8D1B1561C820E08357E096E2CE78EF632C48041403E575EACA3D4F523DEBB0B79D2EADE39E2394914329F634974D3ADA4AD6C8AF38426356E85B1C034F87CDF253CE2A64C7CDB46067F334FACD7B7B1D234E946F8EDE0762CEF2720B31EFF009FB57337D60DA54D046AFE6DA4A9FBB97D0819C1F5E391EDEBD6A9C87D01355DBCCF451F5A61563D5BF215198877C9FA9A362A8E00155AE54A9122330CF5E78CD5713B2B02E32477AD0D3AD96F3508AE08CA5B0DE47AB7F0FE479FC2B750EC4B98C1F96E36F99F553C563794CC3E690FFC078A0471A761F8D2EF0318071D2925187C8E846698AEC99C11C8C7233504A40923048F99BF2ABD20262017F4AAC07EF0A1EBCD16E555DB1D0D5AEB451DA823208EC6A287E52D19C654E6A6A28C51452D385381E98A4DA0868D8E11FBFA1EC6846D8CC8E30C0E08F4353C6AAEE7736D561B4F3C93DAB5F4AD48D95F791330682E59426D3C2B90727D369C7E7F5AEA2A9CF15EB5FDBCB0DC85B65C89A22A3E6E3820E33D7DC55A570E0907A1C1A1E349576C88AEB9070C33C8E86B1750582FB50FEC9BA33B0962322B471602631825BD4119040FAF5AE727825B2BB92CE7E593949318122F63F5E3047A8A8181A8C8A8C8A6114C9137A15F51D6B3661E5062E301464FD2BA1D32C8DA5AD9ACBB866613DC04386F5007D30B9FC6AE4ADBEEAE2555DB1BC85917D07FF5CE4FE35941959B6A824FFB6C17F4EB4A5046E3CC60993C6109E7EA7FC2A159CCCADB8E4A123156190C90AB0EA2AB3023208C1F7AAEF8FB4C43A8C9C8ABC65230A010738E79C543C09CFCD9C6466A0470A32BF95680C15047434B8A28A8651B25493D786A9A81452D252D0180EE3F3A5F307604FD052E598636FE74ACA594C9FC6BC38EE4763F87F2A7A3EE5C1CE7DBD2ADC5B4C643152E4649271C75E3DFFAD745A26A46EA1305C4A1AEA3E49DB8DEB9C06F4F638E86B5AAB410C96F24AF2DCCB3798D955651841E8303F53ED56010C3233F88C535A35624E30D8C6E1D40AE75ED2DB53B3BA849BA8AE6DE4644B9BA555CB7538DBC15E3FAF5E6B9D4676678A54D93C4DB645F43EC7B8A185467AD464530D2C16A975768B226E8D3E77FA0E83F3FE55B6C498219B0C4C8CEAE31F748FF00115131ACE63243197721631D5632133F903FCEA95C4C409802710CAA41CF6FF269611B6EEE9074F3091F8D5E898984A83FED7F4A86793CCC640CD53EB7431D96ACB1C1CE4FD6AB961927D067AD5681F70E2B52D5F3115279078A9A8C5148EBBE365F6E2990B164E7A8E29E5D57A914DF341FBA09A0339FE103F1A5DAC7AB01F41408C1EA49FA9A7AA81D853C5381A0E47CC3D304531498D87B1E2A6460CCB8E3FC2AE4774F04D14F6D81229E133F7C775CF6CE3AF635D759DDC57B691DC42DB91C641C517903DCDA4B0C73342EEB8122672BEFC11505A5CC31B8B047B8964846D67911CE4E33CB91827F1ABD59BAD074B092E165995624666488292FEDF30231F867F91C0D4F4D6934AB7D5E386586E63840960277B4883D49C1C8193D338E3E992196440EA72A4641F5A6114C6E054648C678C7AD68E9F014B07B83D1981738FBBFDD07FCF7A9F711C5464D730BA84D70985C04E376159BF980294DD4531B9562A1E40AA36B6ECE31CF1D2AE4609BE91C72191738F5156E3181F8D24C14316DA704D5200B5CB103A0A964E0631838EF55F69DE4E3F0AA8AA60B820F0A795C5695A37EF7AF0473569A68D7AB8FC28F341FBA09FC29A5A4ED1803DCD26C91BEF498FF00745336EC982B64A9A9C220E8A3F2A5ED8A2814B4A3A53A9453C7E951B2160547DEFE1F7A23900E0FFF00A8D5981943FCCA0AF1B47BD69E91A8FD8EEC4323BB4126140033B1C93CFB03EDDFEB5D5553BEB6334904ED753431404BBA46C479831D0E3B71D2A4B4BD8AF632F089768EEF1B267E99033562B1AF2CFCAD4127CEA37226907EE632BB23C0EB9E0A8FC79C91839AC5D6F4BFB15CBDE5A28364C3F7814E444F9C703B03EDD39ACA61C5413FCB0391D718FCEAAD9AC935E24432631F3480F651FF00D7C0AE86395A3B4B8B646FDC4E72CBD71EB8F4CD44C72734D1CD72D1691793383388CAF6595CB91F80AD04D1085C35CC89ED1058FF009726ACDBE9F05B670F2331E492739A9F6A8E99C5238CA30F6AA6130848E771FCA823239A8738FCEA39E2DE8AC3AA9E9EB525A01248148E31D2B4046ABD1453B149DA8A8E75DD1E4755E69E8DBD037AD2D14514A0D28A753F341191D7A74A8DF1BF7FF7FAFB1A955C11CF5A9D76344C5810E461981EC7FCE47BD74DA15F49756AD14C774B090BBFFBEA7EEB7D71D7DC1AD5ACF9DD2C6EDAEEEEFA4113E238E2DBF22F7E703AF07935762952640E8C187B107F952C88248D90920302323A8AE76058A3BDB8D0649279E13016964910617774F9BF97BE7F0E7EFED5B4CBE5B732096DA55DD6F3F077E3A8247191EDD45559C66171ED9FCA8B0B665B759F00B4A41646E8533D3DBD6B52E1965BDB89D136248FB82673ED9FA9EB511A4A89E41D59BF3351F9CA7EE82DF4146E72384FFBE8D3764CDC17551EC28F217396258FBD46EBE518F7740298EC46760207F3A802E58F1D286185E69D6CC165C9EA462AF51451DA93B73D2A18BE491A33F5153514527AD28A5069E29C2969ACA391FC2D4D4250E08191C1C77A9C3ED208FF0022A78A6FB3DCC3756CB978B385CE3783F797F1C03F515D9DADCC7796B15C44DBA3914329F6A7CAACD1B04203E0ED247438AC8B2BE5D3545AEA57D13DD921982F0AA08E00CE38C027F3ABF77AA58D80537575146586554B659BE8A393F8573FACEB70EA16FE45AFDA936BAB194A98C301D472437E98AC49A7B896D5ED4BAF90F289586CE491EE73D4E0F18E9F5AAA91FDA2431B1E9C91ED5A241F21183933994EE5DB8509B7A67BF3C8FCBDE9690D2543E52039DA334E238E2931462822A2BD55FDC91D0A73F5CD55236A927A0A643808770E4D170A10727F0A8C1C106AE2DC2141B9D437A13C9A914E4669D9E2928A8670415900E4706A50720114714514B453C53853A82032E298CBB973FC4BD47A8A23201E3EA2A68994B80E4ED0720FA568E99A9369724ABE5C925A38DCB147B4147C9C9F988E0E7F0ABD26BF74E8DE55B450E7EEB3C9BC8FAA8007FE3D58B2BC923BBCF334D238019DC28240E9C2802ABC490DBE7C98A38F3D76285CFE548F2704FA7350B3E475AB3A7C3116779894DC01CF7C03C8FC8E69FD09048E3D28A4A2994525251515C7FAB1ED542625B083B9E6A4442548EFDAA1B80D27CA5B9F5A8619864C6F8DCB44F6F2CF033C4A48560BC0EE6B4ADA378ADD1246DCE0726A5E8293E9453580652BEB51C0DF2943D4548E5514B13802A8CB7AF9063000F7E6AF8395068A5A703C53B34A297701DE937FCC186685407A0E2A5031D0D383014196A267CD465BAD309A8A2C4937924F41BBEA3FCF15A3499A5A4A0D37141A4032703F0A40411C608A29AC9E62EDFC6A9B44044930E77F1F8F7A898B0EF8A880279AAF3447CC0E83EB5A562BFB92C4724D59C62B2B5672972801207960E01E3350DB5F3C4FF312C87A827A56B24892A0743953DE9D503FEEE60F9C06EB546F2EC492EC46F917F5355C36475ADA86412428E3A114FCE3AD37CC41FC5F95287CF45269C379E3814E0A475269E001DA9DC6314C0763ED3D0D4B9A4CD349C5318D309A61353DBA6C42C47CEDFA0F4A9A97AD14B45369293BFD2A093740E655E6363F3AFF0077DC54D91D41C8A729C106A8A29F23CA7FF9672311F8D473A95566FE10338A8D7EE0FA542E41620D4905C189F6B1CAD68E3D8D676B3016B749D7398CED6FA1AC41211C55DB0BD304CA8C7F76EDCFB1F5ADC240049E00ACED46ED45B208F077E49F6C56487C9EB52ABF1C56AD8166B6003600247EB567CA04F2C4D38228E829E38A7538528A5CF6A6B8CAFB8A556DCB9EF4A4D349A631A8277290B3AF55C1E7B8A2DD85C9040F9472DFE157CD2834B4034A79E28A08A422931505C5C0B60B91966E40F4155D2E5158B2E44248041FE027FA55D242F5207D6B22F2E0A5EF99182C806DE3B8F5A7492096DCB21241E94FC0DBD2A9CFB81F971D6910AC8BC751C1159B76CCF70CACC5B1C007B55AD3904573FBE23CA9119180F7F5AA3346629190FF0009C522F2A78E2B4E3BB2F600173B81D98F6A8B7E78A8240036463148AD5B9A7E3EC3160FA93F5CD5AFAD2819E0714C82512C79E37025587A114FF3143AA67E63DAA514B494B9A8C9D8F9EC69F9CD349E6987A546F82A41190460D4BA7DB9B6882C8065C31723A86C7CBF8671560676F38CF7C53852FBD2F5A28AACD77B246564C8048E0F34E8EEE197233B4F4C31A9D40DC01E99E6B12795A590BB1CF381EC292D648C5C797391E448A52407F4A494FEFDF32090838DC08391DA9377BD3946F7545206E600D58C8573CE2AAC9F3313D6ABC709323B06DA3F99AA247EFDDD860E7A53C3330E871EB524C9E75AB4CE4EF1208C13DC63355B8036D3636DAC6B56C635110918659BA7D292F2DC4CE8B6F1132310A028FBC4F4C7BD67CB04D6EEC9344F1B29C1575208352DA5F3DAEE00864273B4D5E1AC26DE6339FAF14B1EA8CC49F2C6307907A1ED51C374D0C6CAB8CB1073E956AC37492B48DC851804F726B46968A4A4619045468C70413C8A71231CF14DDC08C8208F5A58613348783B5464903F2ABD248240BF22AB0182573CFBD4740A7668F7A514551D45364AAE31890678F5AA079E0D594BD9A388229191FC4464E2A8C991D0E2AB306CE0F5A609194F15324E0F518A9E29009148FF00F555B078F7A814672C73D6A1DFB65C7AF4A82EA076DA5719E8734D1F2461074155A69A4188F71D84EEDBDB3EB5116E29BB88C9ADBB56DD6B1FFBA2AC8C607B5248A92A146E73598FA649B8F96432F6CF150358CE8C14A726AFDBD9C82D5A23852CD92DD78F4A79D3D821DAFB9BB0C62B4ADE110C2B18E70393EA6A514B474A290D4327C8C1C7E34D9C830EEEC0F6AAF14E5711ED24B361456CC70B4368B229CABB346C47A8C13499A4A0528A5C528A2A3781A75DB2360751EC6B2AE209207C3AE33C820F5A881EDDE98F8C7349F673FBB91D488DF95F561EDFE3525BE9E2F5E560C234538E077F4AA5716E90B8549E3906EDBF29E94DB790098AB1C71C55F4947DD3D69C4ED5C7B557957744CC3EF76A89E5630A86C86A80B1355BC9927970149357A2D3B0B976C91DBB54DE54478F2D7E98A488F90FB0FDC3F77DAA78A61283B7380719F5A9832814C372BE6796832DDFD05483939EF5281814A244122AB3004F41EB4A6EA056DA6419F41CD0D3E48D9D054EA432861D0F229692909A69E4107BD57C7CAD13639E95259C0558CCC818AF0A0FEA7F2AD2942895D6325A30C7613DC763519A4A5C53BA0E94528A5A2E25105A4B311928BC0F5278158926A572E30CCBB3FBBB01151ACD0331F39180FF00A647A7E07FC6A658ED9AD645F3E3657FBAE7878CFA11E869B3BB5CDF32C4BC03E544A3B28E07F2C9AB57E16CB4E8ED50E4CA4EF27B8FFEB9E3F0AC0600B600C0F4A022B3649C1A99490E9F5EB571F952691D76C4076AAC53721355564559941F5AD0520720007DA9C5CE3AD42AB82419323D40A36A7619FAD3D47A607D290C851B0C383DC510804993182D56D5BD292494C68485DC6B2A495A594B375AB5042106E3D6AD038C55F518451E82968A434DC648AA025792E80070392703A28EA6B7361813CB04159E24917BE17A8C7A1A4C52639A4C52F738A29452D150DE4F03335ACA1F0A412571F29AA4DA448E43472C4C879539396FA75E6A998E32A3E5150AF996F3C73444168DB7007F97E55BD6020684C96EB8129DF93D793D3F0E9595ABCC1F529541E23C47F97FFAEA8F98A8086039A859933F29C8A6162BC86C56843711CF1ECE8E7A8353CBF74D502E6091830250FA76AACEEAF3938C0278AB8188C62A0966CEE504FB9A7C1195403248AB41081410ABF78F02AACB720B7C830ABC938EB502DDBA0F949DDD81E95792FF0011EE653F854DF6B411EF20E319AAC1E39E5F3153681C73DEAC06C0A9ED977CA3D0726B439A4C50698D22AF53D3D2A93DC3EFDC0E3270055BD2ADDADF3752C7BE36DD132F1C6578E7B11D6AE2642804E4FAD3A8A4A29452D14566EA9118AF1DC03B25F9C1FE62A92CF22F9655C831B164FF0064FA8A455736FE6E3F761F66EF7C671FAD33381CD2C37B359B031329033F2B0E39EBEFDAA2BD9D2E2F669D015591B76D27A715558EEEB4D2A01E94A0C7FC49FAD5BB1B78DA532AF381803D2AF85DD2AAF5C724557B945FB40560003DB354AEADF61DE83BF4AAAD71274CE07D298B264E3BD4D15EB4630543629ED7D2B1C0C0FA51E63BFDE626890623FE750E477FC2A46E1323A7714E918989157BFA54B1908A054E9B9867071F4AD0B220236E5656CF561D455A320EDCD34B39E83149B49FBC6A39CA47130239618155ED5033176EA0E147A7BD69C4C44663CFC858311EE38CD4829F462931CD18E29714B474A434EDD05EDBBA290C1863DD4FAD60DF5B0B2BAF237EFF00915B3B71D47A52D8CC8AD2DA4BC4573B406FEE38E87F502A2B8B59A2804ADDE578F6F7F97A9FA567B499EF5623432DA2C4E40DADB90FA67A8A8248993715058281B881C0CF4CD46C1B6062A42938048E0E3AD33356B4E95D2E70BFC431D6B52D240F2348C4727A7D2AA5D4865B87C7007E95109831F29F8F43505C5B2F5154F6EC6F7A075CFA5203CF6AB5130239ED4B2B645566C039152212454CAB839078C6054A800238CFD6ADA12C054E98153A395E95209B1D6A4043A823BD675DBE6E1C7653B453ADA2257CE63803903D455E858488AEA41561906AC0A7D2D04514014A4525276AC12ECA4152437660704536EA5B8BB904B21DCEAA172001C0E955C315915B0320F75078EFC1E0FE35AFA84E2354B8B475921DA10ACA818AB7D08E338CF1C5645CDC35ECF1349144BB33B8A205DDF5C75A19CA83CFD2A4BAF252C1A357025982798A8E1B95C8CE474CE738AAD797BF698ED9022C6B042230ABD09EE71DB354C9CD3E393CB39CE2AFDACACF0E5491CD3A28CB4B23139C9AAB70AA18967DA57A0C649A75B39906C639FAD32E203BCE14F038C0A8428E94A407312228523827D4E6A6FB14E0718CFB1AAECADD1B22902AFA66A7B58BCD9B0C3E40335A32451F97855008E4605578561C379B318C8E995241FCAACAA6DE3703EE297781C66A7855E604A0C80704E6ACADB37F111F854A1428014600ACF912217323C9280BBFEEE0E6AD991102F2006FBB4C86E10388B80C73F281D31571181A901A70A5A314B8A3B52638A315CDEEECC3F1A9617F92445009618AA5705924DAC30476A60B87505720FD6A3321073DEAFF00D93312B063E6633CF4ACF91597AF350B21CE4D0A9B8D39A35EDD6ADC2E208B9A9ECA412C92A8EA791EF556F930E0D578B319DC2AF9957CBDCEC01DB9ACE6725B029CAC15949EA0E6B5A294488187719AA77506D7DC0E431A9AD4582DB98AED655959B9755E833C63F0A6DB20899C29DCB9E0E319153BBE01E9D2AA2FCCDCE31DEACF99B578A1119B92702AF41398A3540ABB47E67DEAE472AC8A48EC704536E261047B88CE4E00AA173247711E4A10E3B8FEB55A3B8DB1089C65074148252D26E1C153B8135AB6F3F9B1071C67A8F4AB2AE735286A7834BD2955B6EEF465DA41EDC8391EFC52514B5FFFDA000801021100FF000186A0D8000C4170000000000B8B6E81D40060001A0C4016000000061A083701800000EC003B751000084D0C00043000018F756EA43B6EC7E43BDC2C002000000000001DC34681AB0817914B6B80AC4F3598E3606000000000301AD7424077EE5342264931683E80000201805800681EA2135D0B8DEF61B4D129886D8800000000006161CACB6D0949B76434EC55DDAC67D46310082C30001277180EE30D04B4D868572460000021357D82FDC6C490C6003B8081B10C5706257B0C620130BD861702840170EA02006856452100C4020417180C04D3400001BE81604310C4C043000006EC0B60000138A6EE1E434860C4301201882E34436EF628006215860030B80900C40017424D06A30B001FFFDA000801031100FF00000000000000000000006840000000000000000000026030000000010C000000480600000020BD96A36ECB5100C04300100C0000000560F2180900C431000C0043000010DA007AEE218986C000030000000100EFA081F7000001886000000020B8C496A0D0930B7518C0040310C00043100C400030010000000C43100000000000005C002E003100000008770000001000C0000000043010C00403100C00000002F610C00620000015C60000002188060031009A01858000000FFFD9");
		File file = new File("e:\\Images\\081608113918.jpg");
		java.io.InputStream is = null;

		ByteArrayInputStream bais = null;
		try {
			is = new java.io.FileInputStream(file);
			//op.insertPicStreamInfo(is);
		} catch (Exception ex) {

			ex.printStackTrace();
		}
	}

    public synchronized static TTerminal findTerminalByDeviceId(String deviceId) {
        Connection conn = DbUtil.getConnection();
        TTerminal terminal = null;
        PreparedStatement pst = null;
        ResultSet rs = null;
        String sql = "select * from t_terminal where device_id=? ";
        try {
            conn.setAutoCommit(false);
            pst = conn.prepareStatement(sql);
            pst.setString(1, deviceId);
            
            rs = pst.executeQuery();
            if (rs.next()){
                terminal = new TTerminal();
                terminal.setTermName(rs.getString("TERM_NAME"));
                terminal.setImgUrl(rs.getString("IMG_URL"));
                terminal.setSuiteId(rs.getLong("SUITE_ID"));
                terminal.setEntCode(rs.getString("ENT_CODE"));
                terminal.setDeviceId(rs.getString("DEVICE_ID"));
                terminal.setTypeCode(rs.getString("TYPE_CODE"));
                terminal.setSimcard(rs.getString("SIMCARD"));
                terminal.setOemCode(rs.getString("OEM_CODE"));
                terminal.setDriverNumber(rs.getString("DRIVER_NUMBER"));
                terminal.setLocateType(rs.getString("LOCATE_TYPE"));
                terminal.setCarTypeId(rs.getLong("CAR_TYPE_ID"));
                terminal.setIsAllocate(rs.getString("IS_ALLOCATE"));
                terminal.setCrtdate(rs.getDate("CRTDATE"));
                terminal.setSubCompany(rs.getString("SUB_COMPANY"));
                terminal.setOutdate(rs.getDate("OUTDATE"));
                terminal.setUsageFlag(rs.getLong("USAGE_FLAG"));
                terminal.setProtocolPwd(rs.getString("PROTOCOL_PWD"));
                terminal.setAreaAlarmFlag(rs.getString("AREA_ALARM_FLAG"));
                terminal.setSpeedAlarmFlag(rs.getString("SPEED_ALARM_FLAG"));
                terminal.setStartTime(rs.getString("START_TIME"));
                terminal.setEndTime(rs.getString("END_TIME"));
                terminal.setGetherInterval(rs.getLong("GETHER_INTERVAL"));
                terminal.setVehicleNumber(rs.getString("VEHICLE_NUMBER"));
                terminal.setVehicleType(rs.getString("VEHICLE_TYPE"));
                terminal.setOilSpeedLimit(rs.getLong("OIL_SPEED_LIMIT"));
                terminal.setSpeedAlarmLimit(rs.getLong("SPEED_ALARM_LIMIT"));
                terminal.setSpeedAlarmLast(rs.getLong("SPEED_ALARM_LAST"));
                terminal.setHoldAlarmFlag(rs.getString("HOLD_ALARM_FLAG"));
                terminal.setProvince(rs.getString("PROVINCE"));
                terminal.setCity(rs.getString("CITY"));
                terminal.setTermdesc(rs.getString("TERM_DESC"));
                terminal.setWeek(rs.getLong("WEEK"));
                terminal.setCarTypeInfoId(rs.getLong("CAR_TYPE_INFO_ID"));
                terminal.setExpirationTime(rs.getDate("EXPIRATION_TIME"));
                terminal.setExpirationFlag(rs.getLong("EXPIRATION_FLAG"));
                terminal.setImsi(rs.getString("IMSI"));
                terminal.setCreateon(rs.getLong("CREATEON"));
                terminal.setLastupdateon(rs.getLong("LASTUPDATEON"));
                terminal.setStates(rs.getLong("STATES"));
                terminal.setTermType(rs.getString("TERM_TYPE"));
                
                
            }
            conn.commit();
            conn.setAutoCommit(true);
        } catch (Exception ex) {
            Log.getInstance().errorLog(ex.getMessage(), ex);
        } finally {
            DbOperation.release(null, rs, pst, conn);
        }
        return terminal;
    }

    public synchronized static TEnt findEntByentCode(String entCode) {
        Connection conn = DbUtil.getConnection();
        TEnt tEnt = null;
        PreparedStatement pst = null;
        ResultSet rs = null;
        String sql = "select * from t_ent where ent_code=? ";
        try {
            conn.setAutoCommit(false);
            pst = conn.prepareStatement(sql);
            pst.setString(1, entCode);
            rs = pst.executeQuery();
            if (rs.next()){
                tEnt = new TEnt();
                tEnt.setId(rs.getLong("id"));
                tEnt.setEntCode(rs.getString("ENT_CODE"));
                tEnt.setEntName(rs.getString("ENT_NAME"));
                tEnt.setOpenTime(rs.getDate("OPEN_TIME"));
                tEnt.setEndTime(rs.getDate("END_TIME"));
                tEnt.setEntStatus(rs.getString("ENT_STATUS"));
                tEnt.setCenterX(rs.getString("CENTER_X"));
                tEnt.setCenterY(rs.getString("CENTER_Y"));
                tEnt.setMapZoom(rs.getLong("MAP_ZOOM"));
                tEnt.setLogoUrl(rs.getString("LOGO_URL"));
                tEnt.setEntCrtDate(rs.getDate("ENT_CRT_DATE"));
                tEnt.setFeeType(rs.getLong("FEE_TYPE"));
                tEnt.setBusinessId(rs.getString("BUSINESS_ID"));
                tEnt.setAreaCode(rs.getString("AREA_CODE"));
                tEnt.setEntType(rs.getLong("ENT_TYPE"));
                tEnt.setOtherInfo(rs.getString("OTHER_INFO"));
                tEnt.setMaxUserNum(rs.getLong("MAX_USER_NUM"));
                tEnt.setSmsAccount(rs.getString("SMS_ACCOUNT"));
                tEnt.setSmsPwd(rs.getString("SMS_PWD"));
                tEnt.setVisitDistance(rs.getLong("VISIT_DISTANCE"));
                tEnt.setDoubleVisitTime(rs.getLong("DOUBLE_VISIT_TIME"));
                tEnt.setVisitPlaceDistance(rs.getLong("VISIT_PLACE_DISTANCE"));
                tEnt.setVisitTjOrder(rs.getLong("VISIT_TJ_ORDER"));
                tEnt.setSmsTotal(rs.getLong("SMSTOTAL"));
                tEnt.setSmsAvailable(rs.getLong("SMS_AVAILABLE"));
                tEnt.setSmsType(rs.getLong("SMS_TYPE"));
                tEnt.setVisitTjStatus(rs.getLong("VISIT_TJ_STATUS"));
                tEnt.setReportStatus(rs.getLong("REPORT_STATUS"));
                tEnt.setSmsCount(rs.getLong("SMS_COUNT"));
                tEnt.setHashCode(rs.getLong("HASH_CODE"));
                tEnt.setCarGreyInterval(rs.getLong("CAR_GREY_INTERVAL"));
                tEnt.setPersionGreyInterval(rs.getLong("PERSION_GREY_INTERVAL"));
                tEnt.setStatus(rs.getLong("STATUS"));
                tEnt.setCreateby(rs.getString("CREATEBY"));
                tEnt.setLastupdateby(rs.getString("LASTUPDATEBY"));
                tEnt.setCreateon(rs.getLong("CREATEON"));
                tEnt.setLastupdateon(rs.getLong("LASTUPDATEON"));
                tEnt.setEditionCode(rs.getString("EDITION_CODE"));
                tEnt.setVersion(rs.getString("VERSION"));
                tEnt.setMmsAccount(rs.getString("MMS_ACCOUNT"));
                tEnt.setMmsPwd(rs.getString("MMS_PWD"));
            }
            conn.commit();
            conn.setAutoCommit(true);
        } catch (Exception ex) {
            Log.getInstance().errorLog(ex.getMessage(), ex);
        } finally {
            DbOperation.release(null, rs, pst, conn);
        }
        return tEnt;
    }
    
}
